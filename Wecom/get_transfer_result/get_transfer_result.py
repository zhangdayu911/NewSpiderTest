import pandas as pd
import requests
import logging
import sys
from NewSpiderTest.Wecom.Basic_methods.get_access_token import get_access_token

# 配置日志记录器的根日志级别和输出地点
logging.basicConfig(level=logging.DEBUG, stream=sys.stdout)


def get_transfer_result(handover_takeover_dict):
    # 创建一个空的DataFrame
    df = pd.DataFrame(columns=['handover_userid', 'takeover_userid', 'external_userid', 'status', 'takeover_time'])

    # “查询客户接替状态”接口内容
    url = "https://qyapi.weixin.qq.com/cgi-bin/externalcontact/transfer_result?"
    access_token = get_access_token()


    # 遍历数据
    for handover_userid, takeover_userid in handover_takeover_dict.items():
        params = {"access_token": access_token}
        data = {"handover_userid": handover_userid, "takeover_userid": takeover_userid}

        logging.info(f'发送请求 to {url} with params {params} and data {data}')

        response = requests.post(url, params=params, json=data)
        json_transfer_result = response.json()
        logging.info(f'解析返回结果 json_transfer_result 为 {json_transfer_result}')

        # 将当前接口返回的客户数据转换为DataFrame，并添加对应的 handover_userid 和 takeover_userid
        new_df = pd.DataFrame(json_transfer_result['customer'])
        new_df['takeover_userid'] = takeover_userid
        new_df['handover_userid'] = handover_userid

        df = pd.concat([df, new_df], ignore_index=True, sort=False)

    return df


# 定义需要处理的 handover_userid 和 takeover_list，以字典的形式表示一一对应的关系
handover_takeover_dict = {
    "011065": "950008",
    "780047": "950008",
    "010176": "950008",
    "011080": "950008",
    "772143": "950008",
    "004546": "950008",
    "008264": "950008",
    "008925": "950008",
    "001114": "950008",
    "003848": "950008",
    "001267": "950008",
    "008209": "950008",
    "780045": "950008",
    "010200": "950008",
    "000576": "950008",
    "004528": "950008",
    "000199": "950008",
    "003669": "950008",
    "000018": "950008",
    "780160": "950008",
    "009040": "950008",
    "000320": "950008",
    "780159": "950008",
    "010512": "950008",
    "003710": "950008",
    "000928": "950008",
    "002471": "950008",
    "002133": "950008",
    "771107": "950008",
    "004552": "950008",
    "011158": "950008",
    "008546": "950008",
    "780046": "950008",
    "772241": "950008",
    "009288": "950008",
    "003824": "950008",
    "780162": "950008",
    "010917": "950008",
    "009481": "950008",
    "008404": "950009",
    "000411": "950009",
    "008999": "950009",
    "003293": "950009",
    "001414": "950009",
    "770916": "950009",
    "003651": "950009",
    "780072": "950009",
    "008092": "950009",
    "008878": "950009",
    "008541": "950009",
    "011145": "950009",
    "000452": "950009",
    "009077": "950009",
    "001726": "950009",
    "771864": "950009",
    "010936": "950009",
    "009781": "950009",
    "780073": "950009",
    "003273": "950009",
    "008103": "950009",
    "008831": "950009",
    "009035": "950010",
    "008944": "950010",
    "009709": "950010",
    "000298": "950010",
    "770640": "950010",
    "780137": "950010",
    "010911": "950010",
    "003263": "950010",
    "010540": "950010",
    "000221": "950010",
    "004455": "950010",
    "000368": "950010",
    "000284": "950010",
    "010048": "950010",
    "001180": "950010",
    "001030": "950010",
    "010641": "950010",
    "011152": "950010",
    "008106": "950010",
    "001516": "950010",
    "008942": "950010",
    "008019": "950010",
    "008675": "950011",
    "004544": "950011",
    "008198": "950011",
    "003468": "950011",
    "000416": "950011",
    "000791": "950011",
    "008965": "950011",
    "010204": "950011",
    "003461": "950011",
    "771756": "950011",
    "771219": "950011",
    "008059": "950011",
    "009418": "950011",
    "000822": "950011",
    "780087": "950011",
    "000513": "950011",
    "009342": "950011",
    "003266": "950011",
    "004541": "950011",
    "009173": "950011",
    "009327": "950011",
    "009273": "950011",
    "009179": "950011",
    "010937": "950011",
    "008068": "950011",
    "008551": "950011",
    "001021": "950011",
    "004626": "950011",
    "002233": "950011",
    "772246": "950011",
    "001255": "950011",
    "008101": "950011",
    "000521": "950011",
    "780106": "950011",
    "15725496636": "950011",
    "009684": "950011",
    "771650": "950012",
    "001518": "950012",
    "003398": "950012",
    "002578": "950012",
    "003480": "950012",
    "003553": "950012",
    "010632": "950012",
    "003296": "950012",
    "010799": "950012",
    "001152": "950012",
    "000817": "950012",
    "009377": "950012",
    "009375": "950012",
    "009378": "950012",
    "002763": "950012",
    "001168": "950012",
    "002770": "950012",
    "004331": "950012",
    "009379": "950012",
    "003773": "950012",
    "003222": "950012",
    "003415": "950012",
    "011024": "950012",
    "009374": "950012",
    "008213": "950012",
    "008782": "950012",
    "001863": "950012",
    "002540": "950012",
    "002684": "950012",
    "003546": "950012",
    "004440": "950012",
    "001864": "950012",
    "004195": "950012",
    "010403": "950012",
    "010131": "950012",
    "008786": "950012",
    "004337": "950012",
    "009619": "950012",
    "004225": "950012",
    "010686": "950012",
    "004229": "950012",
    "003568": "950012",
    "010130": "950012",
    "003628": "950012",
    "004084": "950012",
    "010129": "950012",
    "003139": "950012",
    "002969": "950012",
    "003571": "950012",
    "000876": "950012",
    "002238": "950012",
    "001876": "950012",
    "009401": "950012",
    "002806": "950012",
    "772172": "950012",
    "000905": "950012",
    "002967": "950012",
    "009369": "950014",
    "010094": "950014",
    "010642": "950014",
    "009867": "950014",
    "010618": "950014",
    "001821": "950014",
    "004097": "950014",
    "000790": "950014",
    "010066": "950014",
    "010924": "950014",
    "003430": "950014",
    "011056": "950014",
    "009817": "950014",
    "004161": "950014",
    "011054": "950014",
    "008734": "950014",
    "004121": "950014",
    "011053": "950014",
    "010800": "950014",
    "004438": "950014",
    "010648": "950014",
    "002273": "950014",
    "003434": "950014",
    "010640": "950014",
    "001738": "950014",
    "004680": "950014",
    "009368": "950014",
    "010967": "950014",
    "009834": "950014",
    "001735": "950014",
    "010956": "950014",
    "004634": "950014",
    "009367": "950014",
    "010573": "950014",
    "009831": "950014",
    "004426": "950014",
    "003792": "950014",
    "003790": "950014",
    "004162": "950014",
    "010810": "950014",
    "004649": "950014",
    "009824": "950014",
    "010955": "950014",
    "009825": "950014",
    "010572": "950014",
    "004197": "950014",
    "009826": "950014",
    "009840": "950014",
    "003116": "950014",
    "010063": "950014",
    "770815": "950014",
    "009838": "950014",
    "771187": "950014",
    "009302": "950014",
    "009220": "950014",
    "001737": "950014",
    "18706239156": "950014",
    "772040": "950014",
    "772041": "950014",
    "772043": "950014",
    "772042": "950014",
    "009635": "950014",
    "772045": "950014",
    "009868": "950014",
    "000083": "950013",
    "000950": "950013",
    "002321": "950013",
    "002323": "950013",
    "002394": "950013",
    "003414": "950013",
    "002900": "950013",
    "002754": "950013",
    "001717": "950013",
    "000611": "950013",
    "002332": "950013",
    "002743": "950013",
    "002421": "950013",
    "002494": "950013",
    "002317": "950013",
    "002425": "950013",
    "002329": "950013",
    "003783": "950013",
    "010887": "950013",
    "004145": "950013",
    "004149": "950013",
    "004146": "950013",
    "003473": "950013",
    "003483": "950013",
    "002576": "950013",
    "002339": "950013",
    "002422": "950013",
    "002745": "950013",
    "002747": "950013",
    "002862": "950013",
    "002864": "950013",
    "002865": "950013",
    "003342": "950013",
    "003609": "950013",
    "010626": "950013",
    "010684": "950013",
    "003916": "950013",
    "003917": "950013",
    "003982": "950013",
    "011060": "950013",
    "009633": "950013",
    "010984": "950013",
    "003996": "950013",
    "004007": "950013",
    "010885": "950013",
    "004258": "950013",
    "004323": "950013",
    "004326": "950013",
    "004341": "950013",
    "004338": "950013",
    "004404": "950013",
    "004420": "950013",
    "004588": "950013",
    "004590": "950013",
    "002116": "950013",
    "003836": "950015",
    "000250": "950015",
    "003522": "950015",
    "004542": "950015",
    "002246": "950015",
    "009911": "950015",
    "009013": "950015",
    "004545": "950015",
    "011071": "950015",
    "008286": "950015",
    "009493": "950015",
    "003667": "950015",
    "770628": "950015",
    "001036": "950015",
    "001023": "950015",
    "009693": "950015",
    "008133": "950015",
    "001162": "950015",
    "010921": "950015",
    "780020": "950016",
    "010183": "950016",
    "003787": "950016",
    "008807": "950016",
    "000858": "950016",
    "772217": "950016",
    "008808": "950016",
    "001637": "950016",
    "000998": "950016",
    "011045": "950016",
    "002903": "950016",
    "009238": "950016",
    "004294": "950016",
    "000488": "950017",
    "000837": "950017",
    "002761": "950017",
    "002925": "950017",
    "003991": "950017",
    "004559": "950017",
    "008963": "950017",
    "003234": "950017",
    "008959": "950017",
    "001711": "950017",
    "004713": "950017",
    "008905": "950017",
    "003318": "950017",
    "771651": "950017",
    "001932": "950017",
    "010337": "950017",
    "008960": "950017",
    "008906": "950017",
    "009218": "950017",
    "001880": "950017",
    "004636": "950017",
    "000909": "950017",
    "000262": "950017",
    "001014": "950017",
    "008227": "950017",
    "003032": "950021",
    "010192": "950021",
    "003638": "950021",
    "008998": "950021",
    "002005": "950021",
    "004303": "950021",
    "009714": "950021",
    "001182": "950021",
    "009339": "950021",
    "780203": "950021",
    "770644": "950021",
    "001109": "950021",
    "003287": "950021",
    "002263": "950021",
    "008464": "950021",
    "000814": "950021",
    "780353": "950021",
    "000717": "950021",
    "009455": "950021",
    "000686": "950021",
    "000714": "950021",
    "008408": "950021",
    "780189": "950021",
    "780095": "950021",
    "009748": "950021",
    "004128": "950021",
    "009780": "950021",
    "008084": "950021",
    "780068": "950021",
    "000147": "950021",
    "009679": "950021",
    "780190": "950021",
    "000718": "950021",
    "010206": "950021",
    "010213": "950021",
    "009429": "950021",
    "004122": "950022",
    "003376": "950022",
    "003717": "950022",
    "772034": "950022",
    "000771": "950022",
    "010753": "950022",
    "000904": "950022",
    "003462": "950022",
    "772033": "950022",
    "010922": "950022",
    "010923": "950022",
    "010825": "950022",
    "004092": "950022",
    "003377": "950022",
    "772035": "950022",
    "003375": "950022",
    "000847": "950022",
    "004676": "950022",
    "008862": "950022",
    "010043": "950022",
    "001907": "950022",
    "001908": "950022",
    "001910": "950022",
    "001912": "950022",
    "001913": "950022",
    "001916": "950022",
    "002542": "950022",
    "003117": "950022",
    "003124": "950022",
    "003185": "950022",
    "003187": "950022",
    "010613": "950022",
    "010614": "950022",
    "003794": "950022",
    "010988": "950022",
    "004108": "950022",
    "004134": "950022",
    "004182": "950022",
    "004193": "950022",
    "004353": "950022",
    "004635": "950022",
    "004648": "950022",
    "009047": "950047",
    "770872": "950047",
    "009282": "950047",
    "000636": "950047",
    "771024": "950047",
    "780097": "950047",
    "008571": "950047",
    "000629": "950047",
    "000125": "950047",
    "004629": "950047",
    "011069": "950047",
    "009426": "950047",
    "009150": "950047",
    "003597": "950047",
    "009263": "950047",
    "001699": "950047",
    "000667": "950047",
    "009981": "950047",
    "000120": "950047",
    "771578": "950047",
    "771579": "950047",
    "004533": "950047",
    "009986": "950047",
    "000577": "950047",
    "001971": "950047",
    "008552": "950047",
    "009283": "950047",
    "001685": "950047",
    "001621": "950047",
    "002472": "950047",
    "009752": "950047",
    "010915": "950047",
    "004461": "950047",
    "008757": "950047",
    "008704": "950047",
    "001323": "950047",
    "771179": "950047",
    "002577": "950047",
    "000593": "950047",
    "009352": "950047",
    "008458": "950047",
    "011166": "950047",
    "000227": "950047",
    "009254": "950047",
    "000631": "950047",
    "771121": "950047",
    "000624": "950047",
    "000614": "950047",
    "000635": "950047",
    "008076": "950047",
    "780100": "950047",
    "000616": "950047",
    "009922": "950047",
    "002274": "950047",
    "780099": "950047",
    "771217": "950047",
    "000612": "950047",
    "008075": "950047",
    "000638": "950047",
    "003370": "950047",
    "771089": "950047",
    "009410": "950047",
    "008077": "950047",
    "780104": "950047",
    "771091": "950047",
    "008874": "950047",
    "009669": "950047",
    "008742": "950047",
    "008073": "950047",
    "000911": "950048",
    "011168": "950048",
    "771948": "950048",
    "003826": "950048",
    "004460": "950048",
    "000590": "950048",
    "001175": "950048",
    "009184": "950048",
    "003833": "950048",
    "008897": "950048",
    "000093": "950048",
    "000549": "950048",
    "010935": "950048",
    "000056": "950048",
    "001681": "950048",
    "011081": "950048",
    "010789": "950048",
    "010943": "950048",
    "009558": "950048",
    "009178": "950048",
    "000548": "950048",
    "008661": "950048",
    "001451": "950048",
    "000540": "950048",
    "008710": "950048",
    "010196": "950048",
    "010904": "950048",
    "008062": "950048",
    "009256": "950048",
    "010786": "950019",
    "009430": "950019",
    "001281": "950019",
    "003463": "950019",
    "011098": "950019",
    "003579": "950019",
    "771898": "950019",
    "003587": "950019",
    "010881": "950019",
    "000098": "950019",
    "003551": "950019",
    "001229": "950019",
    "004518": "950019",
    "002878": "950019",
    "008535": "950019",
    "010900": "950019",
    "003508": "950019",
    "003457": "950019",
    "002553": "950019",
    "011147": "950019",
    "004070": "950020",
    "001893": "950020",
    "000234": "950020",
    "000913": "950020",
    "003464": "950020",
    "001118": "950020",
    "004085": "950020",
    "002910": "950020",
    "004616": "950020",
    "001896": "950020",
    "004043": "950020",
    "003012": "950020",
    "002977": "950020",
    "001805": "950020",
    "004674": "950020",
    "001432": "950020",
    "002635": "950020",
    "001820": "950020",
    "003974": "950020",
    "001856": "950020",
    "010898": "950020",
    "001806": "950020",
    "009328": "950020",
    "008783": "950020",
    "001782": "950020",
    "001787": "950020",
    "001789": "950020",
    "001793": "950020",
    "001802": "950020",
    "002520": "950020",
    "002523": "950020",
    "002524": "950020",
    "002660": "950020",
    "002681": "950020",
    "002698": "950020",
    "003214": "950020",
    "003215": "950020",
    "003427": "950020",
    "003933": "950020",
    "010999": "950020",
    "004238": "950020",
    "000827": "950018",
    "008118": "950018",
    "000386": "950018",
    "003854": "950018",
    "010207": "950018",
    "009351": "950018",
    "004290": "950018",
    "009785": "950018",
    "004284": "950018",
    "001311": "950018",
    "002353": "950018",
    "000390": "950018",
    "002261": "950018",
    "000165": "950018",
    "000658": "950018",
    "000296": "950018",
    "008792": "950018",
    "772281": "950018",
    "009064": "950018",
    "009065": "950018",
    "009412": "950018",
    "004454": "950018",
    "772138": "950018",
    "001230": "950018",
    "010197": "950018",
    "772254": "950018",
    "008729": "950079",
    "003191": "950079",
    "772022": "950079",
    "011002": "950079",
    "772024": "950079",
    "001217": "950079",
    "001846": "950079",
    "008714": "950079",
    "772021": "950079",
    "008902": "950079",
    "770826": "950079",
    "772023": "950079",
    "000948": "950079",
    "001054": "950079",
    "011003": "950079",
    "001052": "950079",
    "008796": "950079",
    "008736": "950079",
    "008717": "950079",
    "008336": "950079",
    "772019": "950079",
    "000812": "950079",
    "002945": "950079",
    "002944": "950079",
    "004704": "950079",
    "18888126690": "950079",
    "008440": "950079",
    "002943": "950079",
    "772026": "950079",
    "003226": "950079",
    "000811": "950079",
    "008591": "950079",
    "009395": "950079",
    "008718": "950079",
    "003225": "950079",
    "008731": "950079",
    "009392": "950079",
    "772027": "950079",
    "008588": "950079",
    "008725": "950079",
    "001848": "950079",
    "008723": "950079",
    "008981": "950079",
    "008781": "950079",
    "771158": "950079",
    "771054": "950079",
    "009919": "950079",
    "009382": "950079",
    "008980": "950079",
    "008968": "950079",
    "002947": "950079",
    "003142": "950079",
    "004517": "950079",
    "004651": "950079",
    "010230": "950079",
    "011015": "950079",
    "009388": "950079",
    "008983": "950079",
    "008613": "950079",
    "009390": "950079",
    "001847": "950079",
    "004040": "950079",
    "004373": "950079",
    "010110": "950079",
    "009385": "950079",
    "001845": "950079",
    "010112": "950079",
    "001850": "950079",
}

# 调用函数并保存结果到Excel文件
result_df = get_transfer_result(handover_takeover_dict)
result_df.to_excel('D:/Work/CS bank/data/transfer_result_2024.xlsx', index=False)